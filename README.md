# homehello
インターホンの音を拾ってIFTTTのWebhookに通知するやつ

## 対象
- 「ピンポン」って鳴るインターホン持ってる人
- マイク付きのラズパイかそれに準じるマシンを持っている人
- jsが嫌いじゃない人

## 動作環境
- Node.jsが入っている Raspberry Pi 4 で動かしています

## 使いかた
- まずifttt側にwebhook受けて反応するやつ作る
- .envファイルを作ってそこに以下を書く
  - `IFTTT_TRIGGER_NAME={IFTTTで作ったやつのトリガー名}`
  - `IFTTT_WEBHOOK_TOKEN={IFTTT側のWebhookトークン}`
- 動かすとずっとlisteningする。

## 開発者向け情報
### 仕組み
ピン・ポンそれぞれの周波数の音が一定時間内にある程度の長さで発生した時「インターホンがなった」と判定します。
ピン・ポンの順番は考慮されません。
実装上は「ピン・ポン」に限らず、何音の組み合わせでも検出可能です。

### メッセージを変えたい
`.env`の`MESSAGE`を変更すればOKです。

### 検出する周波数を変えたい
`.env`の`TARGET_HZ_SET`にお使いのインターホンのメロディーで使われている音の周波数をカンマ区切りで入力してください。1つ以上の音を指定可能です。
検出の遊びは`TARGET_HZ_PLAY`でいじれます。
また、低音・高音ノイズをもうちょっと削りたい場合、`CUTOFF_LOW_INDEX`、`CUTOFF_HIGH_INDEX`、などをいじってみてください。

### 検出の閾値を変えたい
`.env`の`TARGET_SCORES_BY_HZ`に上記で入力したカンマ区切りの順で、それぞれの音が`TARGET_DURATION`内に何msあるかを入力してください。
負荷低減のため、最小粒度は100msです。

### 自宅のピンポン周波数がわからない
スマホのアプリで検出できるやつあります。フーリエ変換とかで検索するとヨシ。
